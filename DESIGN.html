<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <style>
/*--------------------------------------------------------------------------------------------- * Copyright (c) Microsoft Corporation. All rights reserved. * Licensed under the MIT License. See License.txt in the project root for license information. *--------------------------------------------------------------------------------------------*/ body { font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback"; font-size: 14px; padding: 0 12px; line-height: 22px; word-wrap: break-word; } body.scrollBeyondLastLine { margin-bottom: calc(100vh - 22px); } body.showEditorSelection .code-line { position: relative; } body.showEditorSelection .code-active-line:before, body.showEditorSelection .code-line:hover:before { content: ""; display: block; position: absolute; top: 0; left: -12px; height: 100%; } body.showEditorSelection li.code-active-line:before, body.showEditorSelection li.code-line:hover:before { left: -30px; } .vscode-light.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(0, 0, 0, 0.15); } .vscode-light.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(0, 0, 0, 0.40); } .vscode-dark.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 255, 255, 0.4); } .vscode-dark.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 255, 255, 0.60); } .vscode-high-contrast.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 160, 0, 0.7); } .vscode-high-contrast.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 160, 0, 1); } img { max-width: 100%; max-height: 100%; } a { color: #4080D0; text-decoration: none; } a:focus, input:focus, select:focus, textarea:focus { outline: 1px solid -webkit-focus-ring-color; outline-offset: -1px; } hr { border: 0; height: 2px; border-bottom: 2px solid; } h1 { padding-bottom: 0.3em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; } h1, h2, h3 { font-weight: normal; } h1 code, h2 code, h3 code, h4 code, h5 code, h6 code { font-size: inherit; line-height: auto; } a:hover { color: #4080D0; text-decoration: underline; } table { border-collapse: collapse; } table > thead > tr > th { text-align: left; border-bottom: 1px solid; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td { padding: 5px 10px; } table > tbody > tr + tr > td { border-top: 1px solid; } blockquote { margin: 0 7px 0 5px; padding: 0 16px 0 10px; border-left: 5px solid; } code { font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback"; font-size: 14px; line-height: 19px; } body.wordWrap pre { white-space: pre-wrap; } .mac code { font-size: 12px; line-height: 18px; } code > div { padding: 16px; border-radius: 3px; overflow: auto; } /** Theming */ .vscode-light { color: rgb(30, 30, 30); } .vscode-dark { color: #DDD; } .vscode-high-contrast { color: white; } .vscode-light code { color: #A31515; } .vscode-dark code { color: #D7BA7D; } .vscode-light code > div { background-color: rgba(220, 220, 220, 0.4); } .vscode-dark code > div { background-color: rgba(10, 10, 10, 0.4); } .vscode-high-contrast code > div { background-color: rgb(0, 0, 0); } .vscode-high-contrast h1 { border-color: rgb(0, 0, 0); } .vscode-light table > thead > tr > th { border-color: rgba(0, 0, 0, 0.69); } .vscode-dark table > thead > tr > th { border-color: rgba(255, 255, 255, 0.69); } .vscode-light h1, .vscode-light hr, .vscode-light table > tbody > tr + tr > td { border-color: rgba(0, 0, 0, 0.18); } .vscode-dark h1, .vscode-dark hr, .vscode-dark table > tbody > tr + tr > td { border-color: rgba(255, 255, 255, 0.18); } .vscode-light blockquote, .vscode-dark blockquote { background: rgba(127, 127, 127, 0.1); border-color: rgba(0, 122, 204, 0.5); } .vscode-high-contrast blockquote { background: transparent; border-color: #fff; }
</style>
<style>
/* Tomorrow Theme */ /* http://jmblog.github.com/color-themes-for-google-code-highlightjs */ /* Original theme - https://github.com/chriskempson/tomorrow-theme */ /* Tomorrow Comment */ .hljs-comment, .hljs-quote { color: #8e908c; } /* Tomorrow Red */ .hljs-variable, .hljs-template-variable, .hljs-tag, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-regexp, .hljs-deletion { color: #c82829; } /* Tomorrow Orange */ .hljs-number, .hljs-built_in, .hljs-builtin-name, .hljs-literal, .hljs-type, .hljs-params, .hljs-meta, .hljs-link { color: #f5871f; } /* Tomorrow Yellow */ .hljs-attribute { color: #eab700; } /* Tomorrow Green */ .hljs-string, .hljs-symbol, .hljs-bullet, .hljs-addition { color: #718c00; } /* Tomorrow Blue */ .hljs-title, .hljs-section { color: #4271ae; } /* Tomorrow Purple */ .hljs-keyword, .hljs-selector-tag { color: #8959a8; } .hljs { display: block; overflow-x: auto; color: #4d4d4c; padding: 0.5em; } .hljs-emphasis { font-style: italic; } .hljs-strong { font-weight: bold; }
</style>
<style>
ul.contains-task-list { padding-left: 0; } ul ul.contains-task-list { padding-left: 40px; } .task-list-item { list-style-type: none; } .task-list-item-checkbox { vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'HelveticaNeue-Light', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
    </head>
    <body>
        <h1 id="ringo-design-document">Ringo Design Document</h1>
<table>
<thead>
<tr>
<th style="text-align:center">Author</th>
<th style="text-align:center">Class</th>
<th style="text-align:center">Date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Zachary Bloomquist</td>
<td style="text-align:center">Networking I at Georgia Tech</td>
<td style="text-align:center">1 March 2018</td>
</tr>
</tbody>
</table>
<p>Ringo is a protocol used for establishing ring networks and transmitting files upon the created ring network. It can automatically discover all peers in a given ring network and use heuristics to decide on an optimal path between them. Transfers on Ringo are also resistant to network delays and drop-outs.</p>
<p>Ringo uses the UDP transport protocol to transfer data and implements timeouts and resending internally. All headers are ASCII text to simplify the Python implementation, the only binary packets sent are those containing the transmitted data.</p>
<h2 id="timing-diagrams">Timing Diagrams</h2>
<h3 id="new-connection">New Connection</h3>
<p>The following timing diagram depicts what happens to an existing 3-Ringo ring when a new Ringo joins the network. As each server becomes aware of the new Ringo via incoming ping messages, each server pings it back and then broadcasts the new RTT vector. Once every server including the new Ringo has a complete RTT vector, every server must have the same ring configuration because the optimal ring algorithm is deterministic.</p>
<p><img src="file:///home/zach/School/CS3521/ringo/images/ringo-join.jpg" alt="New connection timing diagram"></p>
<div style="page-break-after: always; "></div>
<h3 id="file-transfer">File Transfer</h3>
<p><img src="file:///home/zach/School/CS3521/ringo/images/file-transfer.jpg" alt="File transfer timing diagram"></p>
<h2 id="packet-structure">Packet Structure</h2>
<h3 id="hello-message">Hello Message</h3>
<p>A client sends an initial message to a POC. Upon receiving this message, the POC will send the client a copy if its RTT Vector.</p>
<p>Example:<br>
<code>HELO \r\n</code></p>
<h3 id="keep-alive">Keep-Alive</h3>
<p>A Keep-Alive packet must be sent by every Ringo to every other Ringo directly every 15 seconds. This packet is just an ASCII string with some random integer attached:</p>
<p><code>PING &lt;token&gt;\r\n</code></p>
<p>In response, the pinged Ringo must send the pinging Ringo an ASCII string with the same value attached:</p>
<p><code>PONG &lt;token&gt;\r\n</code></p>
<p>Measuring the round-trip time of this packet is used for RTT measurement for new hosts.</p>
<h3 id="rtt-vector">RTT Vector</h3>
<p>Whenever a Ringo has information abouts its RTT to a new server, it may rebroadcast that information, in addition to all of its other RTT information, to all known peers via an RTT vector announcement. This takes the form of a dictionary of IP address and port to RTT measurement pairs, formatted as follows:</p>
<p><code>RTT &lt;ip-address&gt;:&lt;port&gt;:&lt;rtt-measurement&gt;\r\n</code></p>
<p>The IP address is represented in dot-decimal notation and the RTT measurement is an integer quantity of milliseconds. This pair can be repeated multiple times separated by semicolons (<code>;</code>).</p>
<p>Example:<br>
<code>RTT 10.0.0.1:9001:100;10.0.0.2:9001:200\r\n</code></p>
<p>This vector is also sent as a response to the Hello packet to inform new Ringos of the current known peer list.</p>
<h3 id="data">Data</h3>
<p>A connection is established by sending a packet down the ring containing the filename and the number of bytes the file will be chunked into:</p>
<p><code>FILE &lt;filename&gt; &lt;byte-count&gt;\r\n</code></p>
<p>Upon receiving a packet containing <code>ACK\r\n</code>, the sender will begin transmitting the data as 507-byte chunks with a 1-byte header containing the current sequence number, <code>0-255</code>. This sequence number is unsigned and may roll over. This means each UDP packet will be 508 bytes. The sender will transmit one packet at a time and wait for a corresponding <code>ACK</code> message from the receiver before sending the next packet.</p>
<p>A data packet may be retransmitted if the sender detects a timeout.</p>
<p>Once the data transfer is complete, the sender will terminate the connection by sending a single packet with the final sequence number:</p>
<p><code>BYE &lt;sequence number&gt;\r\n</code></p>
<p>This hangup will also be retransmitted if acknowledgement times out.</p>
<h3 id="ack">ACK</h3>
<p>A receiver may send the special unsequenced <code>ACK\r\n</code> packet to acknowledge that it is ready to receive the file indicated by a <code>FILE</code> request.</p>
<p>Upon receiving a data packet from the sender, the receiver must send an acknowledgment packet with the contents of the first byte of the received packet, the sequence number:</p>
<p><code>ACK &lt;sequence-number&gt;\r\n</code></p>
<h2 id="algorithms">Algorithms</h2>
<h3 id="ring-formation">Ring Formation</h3>
<p>The optimal ring is updated immediately after the RTT matrix is updated. It is formed by first selecting the link between the 2 nodes with the lowest latency, and then selecting the next cheapest link that can be added with one endpoint already on the head or tail of the ring. It terminates once all known nodes are in the ring.</p>
<p>For example, with RTT matrix:</p>
<table>
<thead>
<tr>
<th></th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>a</strong></td>
<td>-</td>
<td><strong>2</strong></td>
<td>12</td>
<td>9</td>
</tr>
<tr>
<td><strong>b</strong></td>
<td>16</td>
<td>-</td>
<td>12</td>
<td>18</td>
</tr>
<tr>
<td><strong>c</strong></td>
<td>9</td>
<td>10</td>
<td>-</td>
<td>12</td>
</tr>
<tr>
<td><strong>d</strong></td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>The ring would be formed iteratively as follows:</p>
<ol>
<li><code>-&gt; a -&gt; b -&gt;</code></li>
<li><code>-&gt; a -&gt; b -&gt; c -&gt;</code></li>
<li><code>-&gt; a -&gt; b -&gt; c -&gt; d -&gt;</code></li>
</ol>
<h4 id="pseudocode">Pseudocode</h4>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimal_ring</span><span class="hljs-params">(rtt_matrix)</span>:</span>
    route = find_minimum_rtt(rtt_matrix)
    <span class="hljs-keyword">while</span> (len(route) &lt; len(rtt_matrix[<span class="hljs-number">0</span>])):
        new_front = find_minimum_rtt(rtt_matrix, incident_to=route[<span class="hljs-number">0</span>], not_in=route)
        new_back = find_minimum_rtt(rtt_matrix, incident_to=route[<span class="hljs-number">1</span>], not_in=route)
        <span class="hljs-keyword">if</span> (get_rtt(new_front) &lt; get_rtt(new_back)):
            route.insert(<span class="hljs-number">0</span>, new_front[<span class="hljs-number">1</span>])
        <span class="hljs-keyword">else</span>:
            route.append(new_back[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">return</span> route
</div></code></pre>
<h2 id="data-structures">Data Structures</h2>
<h3 id="ring">Ring</h3>
<p>The optimal ring is stored as a 1-dimensional array of IP addresse and port pairs. It is understood to be circular.</p>
<h3 id="rtt-matrix">RTT Matrix</h3>
<p>Every Ringo stores a local copy of a matrix containing the round trip times from all known Ringos to all known Ringos. The size of this matrix is <code>n^2</code> if <code>n</code> is the number of Ringos in the network. If an RTT is unknown, it is assumed to be infinite.</p>
<p>The list of all known Ringo IP and port pairss is stored as the list of keys of this matrix.</p>
<h2 id="threads">Threads</h2>
<p>Threads will be used to split up this project. The following threads will be used:</p>
<h3 id="main">Main</h3>
<p>The main thread will spawn all other threads and also keep track of core data structures and the socket. It also is responsible for processing the initial command-line arguments and for sending the <code>HELO</code> connection message to the POC.</p>
<h3 id="keep-alive">Keep-Alive</h3>
<p>This thread is responsible for sending and receiving <code>PING</code> and <code>PONG</code> messages. Additionally, it updates the RTT vector and broadcasts it when changes are made from Keep-Alive RTT measurements.</p>
<h3 id="rtt">RTT</h3>
<p>This thread is responsible for receiving RTT updates and keeping the matrix and ring vector data structures up to date.</p>
<h3 id="cli">CLI</h3>
<p>This thread is responsible for handling user input and for chunking up and sending files. It is also responsible for receiving files.</p>
<style type="text/css">
    h2 {
        page-break-before: always;
    }
    code {
        border: 1px solid #848484;
        border-radius: 2px;
        padding: 2px 5px;
    }
</style>
    </body>
    </html>